import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

# Configuraci√≥n para que los gr√°ficos se vean mejor
sns.set_style("whitegrid")
plt.rcParams['figure.figsize'] = (12, 7) # Tama√±o de gr√°fico ajustado para m√°s claridad

def generar_evolucion_anual(evolucion_anual):
    # 1. Gr√°fico de L√≠neas para la Evoluci√≥n Anual
    plt.figure(figsize=(12, 6))
    sns.lineplot(data=evolucion_anual, x='A√±o', y='Total de Turistas', marker='o', color='#2ecc71', linewidth=3)
    plt.title('1. Evoluci√≥n Anual del N√∫mero Total de Turistas en Costa Rica', fontsize=16)
    plt.xlabel('A√±o')
    plt.ylabel('Total de Turistas')
    plt.xticks(evolucion_anual['A√±o'])
    plt.grid(True, axis='y')
    plt.show()

def generar_grafico_barras(paises_principales):
    # 2. Gr√°fico de Barras para las Nacionalidades
    plt.figure(figsize=(12, 6))
    # Usamos 'Total de Turistas' que fue renombrado en la Celda 2
    sns.barplot(x='Total de Turistas', y='Nacionalidad', data=paises_principales, palette='viridis')
    plt.title('2. Top 5 Pa√≠ses que m√°s Turistas env√≠an a Costa Rica', fontsize=16)
    plt.xlabel('Total de Llegadas')
    plt.ylabel('Nacionalidad')
    plt.show()

def generar_grafico_estacionalidad(estacionalidad):
        # 3. Gr√°fico de Barras para la Estacionalidad
    nombres_meses = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic']
    estacionalidad['Nombre_Mes'] = estacionalidad['Mes'].apply(lambda x: nombres_meses[x-1])

    plt.figure(figsize=(12, 6))
    # Colorear los meses pico (ej. Diciembre, Enero, Febrero, Julio)
    colores_estac = ['#3498db'] * 12
    for mes_num in [1, 2, 7, 12]:
        colores_estac[mes_num-1] = '#e74c3c' # Rojo para meses pico

    sns.barplot(x='Nombre_Mes', y='Promedio Mensual de Llegadas', data=estacionalidad, palette=colores_estac)
    plt.title('3. Promedio Mensual de Llegadas (Estacionalidad)', fontsize=16)
    plt.xlabel('Mes')
    plt.ylabel('Promedio de Llegadas')
    plt.show()

def generar_puntos_de_entrada(puntos_entrada_uso):
    # 4. Gr√°fico de Barras para Puntos de Entrada
    plt.figure(figsize=(12, 6))
    # Usamos 'Total de Llegadas' que fue renombrado en la Celda 2
    sns.barplot(x='Total de Llegadas', y='Punto de Entrada', data=puntos_entrada_uso, palette='cividis')
    plt.title('4. Uso de Puntos de Entrada (Aeropuertos y Fronteras)', fontsize=16)
    plt.xlabel('Total de Turistas')
    plt.ylabel('Punto de Entrada')
    plt.show()

# --- CARGA DE DATOS OFICIALES REALES ---


NOMBRE_ARCHIVO = 'datos_reales_ict.xlsx' 
try:
    if NOMBRE_ARCHIVO.endswith('.csv'):
        df = pd.read_csv(NOMBRE_ARCHIVO)
    elif NOMBRE_ARCHIVO.endswith(('.xls', '.xlsx')):
        # Carga desde Excel
        df = pd.read_excel(NOMBRE_ARCHIVO) 
    else:
        print("Formato de archivo no soportado. Debe ser CSV o Excel.")
        # Usamos datos simulados como respaldo si no se encuentra el archivo
        raise FileNotFoundError 

    print(f"--- DataFrame de Datos Oficiales '{NOMBRE_ARCHIVO}' Cargado ---")
    

    
    if 'A√±o' in df.columns and 'Mes' in df.columns:
        # Crea la columna Fecha usando A√±o, Mes y el d√≠a 01
        df['Fecha'] = pd.to_datetime(df['A√±o'].astype(str) + '-' + df['Mes'].astype(str) + '-01')
    
    # Conversiones finales necesarias
    df['Llegadas'] = pd.to_numeric(df['Llegadas'], errors='coerce').fillna(0).astype(int)
    
    # Se a√±ade la columna 'Mes' al DataFrame final para la Estacionalidad
    df['Mes'] = df['Fecha'].dt.month 
    
    df.sort_values(by='Fecha', inplace=True)

    print(f"Columnas finales del DataFrame: {list(df.columns)}")
    print(df.head())
    print(f"\nN√∫mero total de registros: {len(df)}")

except FileNotFoundError:

    print("ADVERTENCIA: Archivo oficial no encontrado. Creando datos simulados para la demostraci√≥n.")
    
    nacionalidades = ['USA', 'Canad√°', 'Alemania', 'Francia', 'Espa√±a', 'M√©xico', 'Reino Unido']
    puntos_entrada = ['Aeropuerto Internacional Juan Santamar√≠a', 'Aeropuerto Internacional Daniel Oduber Quir√≥s', 'Frontera Pe√±as Blancas', 'Frontera Paso Canoas']
    a√±os = [2022, 2023, 2024, 2025]
    meses = range(1, 13)

    datos = []
    for a√±o in a√±os:
        for mes in meses:
            for _ in range(30):
                datos.append({
                    'Fecha': pd.to_datetime(f'{a√±o}-{mes:02d}-01'),
                    'Nacionalidad': np.random.choice(nacionalidades),
                    'Llegadas': np.random.randint(50, 500) * (1 + (a√±o - 2020) * 0.2),
                    'Punto de Entrada': np.random.choice(puntos_entrada)
                })
    df = pd.DataFrame(datos)
    df['Llegadas'] = df['Llegadas'].astype(int)
    df['Mes'] = df['Fecha'].dt.month
    df.sort_values(by='Fecha', inplace=True)
    
    print("--- DataFrame de Datos Simulados Creado ---")
    print(df.head())
    print(f"\nN√∫mero total de registros: {len(df)}")
    
    
    # --- AN√ÅLISIS DESCRIPTIVO ---

print("\n" + "="*70)
print("             RESULTADOS DEL AN√ÅLISIS DESCRIPTIVO")
print("="*70)

# 1. Evoluci√≥n del n√∫mero de turistas a lo largo de los a√±os (Tendencia Anual)
evolucion_anual = df.groupby(df['Fecha'].dt.year)['Llegadas'].sum().reset_index()
evolucion_anual.columns = ['A√±o', 'Total de Turistas']
print("\n## 1. Evoluci√≥n Anual del N√∫mero de Turistas:")
print(evolucion_anual)

# 2. Pa√≠ses que m√°s turistas env√≠an (Perfil del Visitante)
paises_principales = df.groupby('Nacionalidad')['Llegadas'].sum().nlargest(5).reset_index()

paises_principales.columns = ['Nacionalidad', 'Total de Turistas']
print("\n## 2. Top 5 Pa√≠ses de Origen:")
print(paises_principales)

# 3. Existencia de temporadas altas y bajas (Estacionalidad)
estacionalidad = df.groupby('Mes')['Llegadas'].mean().reset_index()
estacionalidad.columns = ['Mes', 'Promedio Mensual de Llegadas']
estacionalidad_ordenada = estacionalidad.sort_values(by='Promedio Mensual de Llegadas', ascending=False)
print("\n## 3. Estacionalidad (Promedio Mensual de Llegadas):")
print(estacionalidad_ordenada)

# 4. Aeropuertos o fronteras terrestres m√°s utilizados (Puntos de Entrada)
puntos_entrada_uso = df.groupby('Punto de Entrada')['Llegadas'].sum().sort_values(ascending=False).reset_index()

puntos_entrada_uso.columns = ['Punto de Entrada', 'Total de Llegadas']
print("\n## 4. Puntos de Entrada m√°s Utilizados:")
print(puntos_entrada_uso)


# --- VISUALIZACI√ìN DE DATOS ---

print("\n" + "="*70)
print("             GENERACI√ìN DE GR√ÅFICOS")
print("="*70)


#HAcer menu:
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import sys # Para salir del programa de forma limpia

# Configuraci√≥n de estilo
sns.set_style("whitegrid")
plt.rcParams['figure.figsize'] = (12, 7)

# Variables globales para almacenar los resultados del an√°lisis
evolucion_anual = pd.DataFrame()
paises_principales = pd.DataFrame()
estacionalidad = pd.DataFrame()
puntos_entrada_uso = pd.DataFrame()
df = pd.DataFrame()

# ----------------------------------------------------------------------
# 1. FUNCI√ìN DE CARGA DE DATOS (Se ejecuta al inicio)
# ----------------------------------------------------------------------

def cargar_datos():
    """Carga los datos reales o genera datos simulados si falla la carga."""
    global df
    NOMBRE_ARCHIVO = 'datos_reales_ict.xlsx' # ¬°AJUSTA ESTO!

    try:
        if NOMBRE_ARCHIVO.endswith('.csv'):
            df = pd.read_csv(NOMBRE_ARCHIVO)
        elif NOMBRE_ARCHIVO.endswith(('.xls', '.xlsx')):
            df = pd.read_excel(NOMBRE_ARCHIVO) 
        else:
            raise ValueError("Formato de archivo no soportado.")

        print(f"\n‚úÖ Datos oficiales de '{NOMBRE_ARCHIVO}' cargados con √©xito.")

        # --- TAREAS DE LIMPIEZA Y NORMALIZACI√ìN (Adaptar si es necesario) ---
        
        # Asumiendo que ya se renombraron las columnas para coincidir con el proyecto
        
        if 'A√±o' in df.columns and 'Mes' in df.columns:
            df['Fecha'] = pd.to_datetime(df['A√±o'].astype(str) + '-' + df['Mes'].astype(str) + '-01')
        elif 'Fecha' in df.columns:
             df['Fecha'] = pd.to_datetime(df['Fecha'])
        else:
            print("ERROR: Columna 'Fecha' o combinaci√≥n 'A√±o/Mes' no encontrada.")
            raise Exception("Faltan columnas de fecha.")
        
        df['Llegadas'] = pd.to_numeric(df['Llegadas'], errors='coerce').fillna(0).astype(int)
        df['Mes'] = df['Fecha'].dt.month 
        df.sort_values(by='Fecha', inplace=True)
        
        print(f"N√∫mero total de registros: {len(df)}")

    except (FileNotFoundError, ValueError, Exception) as e:
        print(f"\n‚ö†Ô∏è ERROR al cargar el archivo ({e}). Generando datos simulados para continuar...")
        
        # --- GENERACI√ìN DE DATOS SIMULADOS (Respaldo) ---
        np.random.seed(42)
        nacionalidades = ['USA', 'Canad√°', 'Alemania', 'Francia', 'Espa√±a', 'M√©xico', 'Reino Unido']
        puntos_entrada = ['Aeropuerto Internacional Juan Santamar√≠a', 'Aeropuerto Internacional Daniel Oduber Quir√≥s', 'Frontera Pe√±as Blancas', 'Frontera Paso Canoas']
        a√±os = [2020, 2021, 2022, 2023]
        
        datos = []
        for a√±o in a√±os:
            for mes in range(1, 13):
                for _ in range(30):
                    datos.append({
                        'Fecha': pd.to_datetime(f'{a√±o}-{mes:02d}-01'),
                        'Nacionalidad': np.random.choice(nacionalidades),
                        'Llegadas': np.random.randint(50, 500) * (1 + (a√±o - 2020) * 0.2),
                        'Punto de Entrada': np.random.choice(puntos_entrada)
                    })
        df = pd.DataFrame(datos)
        df['Llegadas'] = df['Llegadas'].astype(int)
        df['Mes'] = df['Fecha'].dt.month
        df.sort_values(by='Fecha', inplace=True)
        print("‚úÖ Datos Simulados Generados y Listos para el An√°lisis.")

# ----------------------------------------------------------------------
# 2. FUNCI√ìN DE C√ÅLCULOS (Se ejecuta una sola vez al inicio)
# ----------------------------------------------------------------------

def realizar_calculos():
    """Realiza todos los c√°lculos descriptivos y los guarda en variables globales."""
    global evolucion_anual, paises_principales, estacionalidad, puntos_entrada_uso
    
    # 1. Evoluci√≥n Anual
    evolucion_anual = df.groupby(df['Fecha'].dt.year)['Llegadas'].sum().reset_index()
    evolucion_anual.columns = ['A√±o', 'Total de Turistas']

    # 2. Pa√≠ses Principales
    paises_principales = df.groupby('Nacionalidad')['Llegadas'].sum().nlargest(5).reset_index()
    paises_principales.columns = ['Nacionalidad', 'Total de Turistas']

    # 3. Estacionalidad
    estacionalidad = df.groupby('Mes')['Llegadas'].mean().reset_index()
    estacionalidad.columns = ['Mes', 'Promedio Mensual de Llegadas']

    # 4. Puntos de Entrada
    puntos_entrada_uso = df.groupby('Punto de Entrada')['Llegadas'].sum().sort_values(ascending=False).reset_index()
    puntos_entrada_uso.columns = ['Punto de Entrada', 'Total de Llegadas']
    
    print("\n‚úÖ C√°lculos de an√°lisis completados.")


# ----------------------------------------------------------------------
# 3. FUNCIONES DE VISUALIZACI√ìN
# ----------------------------------------------------------------------

def mostrar_evolucion_anual():
    """Muestra la tabla y el gr√°fico de la evoluci√≥n anual."""
    print("\n" + "-"*50)
    print("ANALISIS 1: EVOLUCI√ìN ANUAL DE TURISTAS")
    print("-" * 50)
    print(evolucion_anual)
    
    plt.figure(figsize=(10, 5))
    sns.lineplot(data=evolucion_anual, x='A√±o', y='Total de Turistas', marker='o', color='#2ecc71', linewidth=3)
    plt.title('Evoluci√≥n Anual del N√∫mero Total de Turistas en Costa Rica', fontsize=16)
    plt.xlabel('A√±o')
    plt.ylabel('Total de Turistas')
    plt.xticks(evolucion_anual['A√±o'].unique())
    plt.show()

def mostrar_top_paises():
    """Muestra la tabla y el gr√°fico de los principales pa√≠ses de origen."""
    print("\n" + "-"*50)
    print("ANALISIS 2: TOP 5 PA√çSES DE ORIGEN")
    print("-" * 50)
    print(paises_principales)
    
    plt.figure(figsize=(10, 6))
    sns.barplot(x='Total de Turistas', y='Nacionalidad', data=paises_principales, palette='viridis')
    plt.title('Top 5 Pa√≠ses que m√°s Turistas env√≠an a Costa Rica', fontsize=16)
    plt.xlabel('Total de Llegadas')
    plt.ylabel('Nacionalidad')
    plt.show()

def mostrar_estacionalidad():
    """Muestra la tabla y el gr√°fico de la estacionalidad."""
    print("\n" + "-"*50)
    print("ANALISIS 3: ESTACIONALIDAD (PROMEDIO MENSUAL)")
    print("-" * 50)
    print(estacionalidad.sort_values(by='Promedio Mensual de Llegadas', ascending=False)) # Mostrar ordenada
    
    nombres_meses = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic']
    estacionalidad['Nombre_Mes'] = estacionalidad['Mes'].apply(lambda x: nombres_meses[x-1])

    plt.figure(figsize=(10, 6))
    colores_estac = ['#3498db'] * 12
    for mes_num in estacionalidad.nlargest(3, 'Promedio Mensual de Llegadas')['Mes']:
        colores_estac[mes_num-1] = '#e74c3c' # Rojo para los 3 meses pico

    sns.barplot(x='Nombre_Mes', y='Promedio Mensual de Llegadas', data=estacionalidad, palette=colores_estac)
    plt.title('Promedio Mensual de Llegadas (Estacionalidad)', fontsize=16)
    plt.xlabel('Mes')
    plt.ylabel('Promedio de Llegadas')
    plt.show()

def mostrar_puntos_entrada():
    """Muestra la tabla y el gr√°fico de los puntos de entrada."""
    print("\n" + "-"*50)
    print("ANALISIS 4: PUNTOS DE ENTRADA M√ÅS UTILIZADOS")
    print("-" * 50)
    print(puntos_entrada_uso)
    
    plt.figure(figsize=(10, 6))
    sns.barplot(x='Total de Llegadas', y='Punto de Entrada', data=puntos_entrada_uso, palette='cividis')
    plt.title('Uso de Puntos de Entrada (Aeropuertos y Fronteras)', fontsize=16)
    plt.xlabel('Total de Turistas')
    plt.ylabel('Punto de Entrada')
    plt.show()


# ----------------------------------------------------------------------
# 4. FUNCI√ìN PRINCIPAL DEL MEN√ö
# ----------------------------------------------------------------------

def mostrar_menu():
    """Muestra el men√∫ de opciones al usuario."""
    print("\n" + "="*50)
    print("         MEN√ö DE AN√ÅLISIS DE TURISMO C.R.")
    print("="*50)
    print("1. Mostrar Evoluci√≥n Anual (Tendencia)")
    print("2. Mostrar Top 5 Pa√≠ses de Origen (Perfil)")
    print("3. Mostrar Estacionalidad (Temporadas Altas/Bajas)")
    print("4. Mostrar Puntos de Entrada m√°s Usados")
    print("5. Mostrar TODOS los gr√°ficos")
    print("0. Salir del Programa")
    print("-" * 50)

def main():
    """Funci√≥n principal que ejecuta la carga, los c√°lculos y el bucle del men√∫."""
    
    # 1. Cargar datos (puede ser real o simulado)
    cargar_datos()
    
    # Si el DataFrame est√° vac√≠o despu√©s de la carga/simulaci√≥n, salimos.
    if df.empty:
        print("ERROR CR√çTICO: No se pudieron cargar o generar datos. Saliendo.")
        sys.exit()
    
    # 2. Realizar todos los c√°lculos de una sola vez
    realizar_calculos()
    
    # 3. Bucle del men√∫
    while True:
        mostrar_menu()
        opcion = input("Seleccione una opci√≥n (0-5): ").strip()
        
        if opcion == '1':
            mostrar_evolucion_anual()
        elif opcion == '2':
            mostrar_top_paises()
        elif opcion == '3':
            mostrar_estacionalidad()
        elif opcion == '4':
            mostrar_puntos_entrada()
        elif opcion == '5':
            print("\n--- MOSTRANDO TODOS LOS GR√ÅFICOS ---")
            mostrar_evolucion_anual()
            mostrar_top_paises()
            mostrar_estacionalidad()
            mostrar_puntos_entrada()
        elif opcion == '0':
            print("\nüëã ¬°Gracias por usar el Analizador de Turismo de Costa Rica! Saliendo...")
            sys.exit()
        else:
            print("\n‚ùå Opci√≥n no v√°lida. Por favor, ingrese un n√∫mero del 0 al 5.")

# Ejecutar el programa principal
if __name__ == "__main__":
    main()




# Llamadas a las funciones de generaci√≥n de gr√°ficos

generar_evolucion_anual(evolucion_anual)

generar_grafico_barras(paises_principales)

generar_grafico_estacionalidad(estacionalidad)

generar_puntos_de_entrada(puntos_entrada_uso)

